<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romaneio Devolução</title>
    
    <!--
      CSS EMBUTIDO PARA MANTER EM UM ARQUIVO ÚNICO
    --><style>
        /* Cor vermelha oficial da J&T Express */
        :root {
            --cor-vermelha-jt: #E2001A;
        }

        /* Configurações gerais da página */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0; /* Fundo cinza para destacar a folha */
            margin: 0;
            padding: 20px;
            -webkit-print-color-adjust: exact; /* Força impressão correta no Chrome */
            color-adjust: exact;
        }

        /* --- ÁREA DE CONTROLES --- */
        .controles {
            width: 210mm;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-sizing: border-box;
            display: flex; /* Habilita flexbox para as colunas */
            gap: 20px; /* Espaçamento entre as colunas */
            align-items: flex-start;
        }
        
        .controles-coluna {
            display: flex;
            flex-direction: column;
            flex-grow: 1; 
            flex-shrink: 0;
            height: 100%; 
        }
        
        /* NOVO MODELO: Coluna de Códigos e Detalhes preenchem o espaço restante */
        .col-auto { flex-basis: 0; flex-grow: 1; } 
        /* Coluna de Botões tem largura fixa e não cresce */
        .col-fixed-buttons { flex-basis: 180px; flex-grow: 0; } 
        
        .controles label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px; /* Espaço menor entre label e input */
        }

        .controles textarea {
            width: 100%;
            height: 200px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            flex-grow: 1; /* O textarea ocupa o espaço restante verticalmente */
            margin-bottom: 10px;
        }

        /* Estilo unificado para inputs e selects */
        .controles input.input-campo, .controles select.input-campo {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 10px;
            min-height: 34px; 
        }
        
        /* Ajuste específico para a Coluna de Botões */
        .col-fixed-buttons {
            justify-content: flex-start; 
        }

        .controles-botoes {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            margin-top: 10px; 
            padding-right: 5px; 
        }
        
        .controles button {
            background-color: var(--cor-vermelha-jt);
            color: white;
            border: none;
            padding: 10px 15px; 
            font-size: 13px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 95%; /* Garante que os botões não ultrapassem 95% da largura disponível */
        }
        
        .controles button:hover {
            background-color: #b00015;
        }

        .controles button#btnImprimir {
            background-color: #007bff;
        }
        .controles button#btnImprimir:hover {
            background-color: #0056b3;
        }


        /* A "folha" de papel A4 */
        .pagina {
            width: 210mm; /* Largura A4 */
            min-height: 297mm; /* Altura A4 (min-height para crescer se necessário) */
            margin: 20px auto; /* Centraliza a folha */
            padding: 15mm;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; /* Garante que o padding não altere a largura */
            position: relative; /* Contexto para o conteúdo e marcas d'água */
        }

        /* --- CABEÇALHO --- */
        .cabecalho {
            /* A imagem tem uma linha azul fina no topo */
            border-top: 4px solid #007bff; 
            border-bottom: 1px solid #333;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .tabela-cabecalho {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .tabela-cabecalho tr td {
            border: 1px solid #333;
            padding: 8px;
            vertical-align: top;
            word-break: break-word; 
        }

        /* Linha 1 */
        .tabela-cabecalho .logo-cell {
            width: 25%;
            vertical-align: middle;
        }
        
        /* Estilo para a imagem da logo */
        .logo-img {
            max-height: 40px; /* Ajusta a altura da logo */
            width: auto;
        }
        
        .tabela-cabecalho .titulo-cell {
            width: 45%;
            text-align: center;
            vertical-align: middle;
        }
        .titulo-cell h1 {
            font-size: 20px;
            margin: 0;
            font-weight: bold;
        }

        .tabela-cabecalho .data-cell {
            width: 30%;
            text-align: center;
            vertical-align: top;
            font-weight: bold;
        }
        .data-cell .data-valor {
            font-size: 1.5em; /* 07/11/2025 está grande na imagem */
            font-weight: bold;
            margin-top: 5px;
        }

        /* Linha 2 */
        .texto-vermelho {
            color: var(--cor-vermelha-jt);
            font-weight: bold;
        }

        /* Linha 3: Ajuste de larguras para evitar overflow no romaneio */
        .tabela-cabecalho tr:nth-child(3) td:nth-child(1) { /* ID LACRE */
            width: 25%; 
        }
        .tabela-cabecalho tr:nth-child(3) td:nth-child(2) { /* Natureza */
            width: 45%; 
        }
        .tabela-cabecalho tr:nth-child(3) td:nth-child(3) { /* Quantidade / Placa */
            width: 30%; 
        }

        .label-cinza {
            color: #555;
            font-weight: bold;
            font-size: 10px;
            background-color: #f0f0f0;
            padding: 4px;
            text-align: center;
        }
        
        .valor-campo {
            font-size: 12px;
            font-weight: bold;
            padding-top: 10px;
            min-height: 20px;
        }
        
        /* Tabela interna para Qtd e Placa */
        .tabela-interna {
            width: 100%;
            border-collapse: collapse;
            margin: -8px; /* Remove o padding da célula pai */
        }
        
        .tabela-interna tr td {
            border: 1px solid #333;
            padding: 0;
            vertical-align: top;
            text-align: center;
            width: 50%;
            word-break: break-word; 
        }
        .tabela-interna .label-cinza {
            border-bottom: 1px solid #333;
            border-top: 0;
            border-left: 0;
        }
        .tabela-interna .valor-campo {
            padding: 8px; /* Adiciona padding de volta */
            min-height: 20px;
            border-bottom: 0;
            border-left: 0;
        }
        
        .tabela-interna tr td:first-child {
             border-left: 1px solid #333;
        }
        
        .tabela-interna tr td:last-child {
            border-right: 0;
        }


        /* --- CONTEÚDO PRINCIPAL --- */
        .conteudo {
            position: relative; 
            z-index: 1;
        }

        /* Marcas d'água */
        .watermark {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 160px; 
            font-weight: bold;
            color: rgba(0, 0, 0, 0.07); 
            z-index: 1; 
            user-select: none; 
        }

        #wm-pagina1 {
            top: 250px;
        }

        #wm-pagina2 {
            top: 1150px; 
        }

        /* Tabela de códigos */
        .tabela-romaneio {
            width: 100%;
            border-collapse: collapse; 
            table-layout: fixed; 
            font-size: 9px; 
            position: relative; 
            z-index: 2;
        }

        .tabela-romaneio th,
        .tabela-romaneio td {
            border: 1px solid #ccc; 
            padding: 4px;
            text-align: center; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            height: 10px; 
        }

        /* Linhas zebradas (cor em linhas pares) */
        .tabela-romaneio tbody tr:nth-child(even) {
            background-color: #f5f5f5; 
        }
        
        /* Placeholder para quando a tabela está vazia */
         .tabela-romaneio tbody tr.placeholder td {
            text-align: center;
            color: #999;
            font-size: 11px;
            padding: 20px;
            background-color: #fafafa;
           }

        /* --- RODAPÉ --- */
        .rodape {
            margin-top: 30px;
            font-size: 12px;
        }

        /* Tabela do Rodapé para Assinaturas */
        .tabela-rodape {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-top: 2px solid #333; 
        }
        
        .tabela-rodape tr td {
            border: 1px solid #333;
            padding: 0;
            vertical-align: top;
            text-align: center;
            width: 25%; 
            word-break: break-word; 
        }
        
        .tabela-rodape .label-cinza-rodape {
            font-size: 10px;
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 5px;
            border-bottom: 1px solid #333;
        }
        
        .tabela-rodape .linha-assinatura-rodape {
            height: 60px; 
            padding: 8px;
            font-size: 11px;
            text-align: left;
            vertical-align: bottom; 
        }
        
        .tabela-rodape .linha-assinatura-rodape strong {
            font-size: 11px;
        }
        
        /* Barra vermelha no final da página */
        .barra-vermelha-final {
            border-top: 5px solid var(--cor-vermelha-jt); 
            margin-top: 0px; 
        }
        
        /* --- ESTILOS DE IMPRESSÃO --- */
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            
            /* Esconde a área de controles ao imprimir */
            .controles {
                display: none;
            }
            
            /* Remove sombra e margens da página ao imprimir */
            .pagina {
                width: 100%;
                min-height: 0;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            
            /* Evita quebras de página dentro de uma linha da tabela */
            .tabela-romaneio tr {
                page-break-inside: avoid;
            }
            
            .tabela-rodape {
                page-break-before: avoid; 
            }
        }

    </style>
</head>
<body>

    <!--
      ***************************************************
      * *
      * ÁREA DE CONTROLES (LAYOUT REORGANIZADO E FIXO)  *
      * *
      ***************************************************
    --><div class="controles">
        <!-- Coluna 1: Códigos (Auto) --><div class="controles-coluna col-auto">
            <label for="inputCodigos">Cole seus códigos aqui (um por linha):</label>
            <textarea id="inputCodigos" placeholder="AM00123456789BR&#10;AM00123456790BR&#10;AM00123456791BR&#10;..."></textarea>
        </div>
        
        <!-- Coluna 2: Detalhes (Auto) - Natureza, Destino, LACRE, PLACA --><div class="controles-coluna col-auto">
            <label for="selectNatureza">Natureza:</label>
            <select id="selectNatureza" class="input-campo">
                <option value="DEVOLUÇÃO AO EMBARCADOR">DEVOLUÇÃO AO EMBARCADOR</option>
                <option value="Devolução Insucessos">Devolução Insucessos</option>
                <option value="Devolução Sobras/Faltas">Devolução Sobras/Faltas</option>
                <option value="Devolução Recusas">Devolução Recusas</option>
            </select>
            
            <label for="inputBaseDestino">Base Destino:</label>
            <!-- Usando datalist para permitir seleção OU digitação livre --><input type="text" id="inputBaseDestino" class="input-campo" list="listaBasesDestino" value="MERCADO LIVRE - MELI" placeholder="Digite ou selecione a base">
            <datalist id="listaBasesDestino">
                <option value="MERCADO LIVRE - MELI">
                <option value="Mercado Livre">
                <option value="SHPX LOGISTICA LTDA - SHOPEE">
                <option value="SHOPEE">
            </datalist>

            <!-- CAMPOS MOVIDOS PARA CÁ --><label for="inputLacre">ID Lacre/ID Viagem:</label>
            <input type="text" id="inputLacre" class="input-campo" placeholder="Opcional">
            
            <label for="inputPlaca">Placa Veículo:</label>
            <input type="text" id="inputPlaca" class="input-campo" placeholder="Opcional">
        </div>

        <!-- Coluna 3: Somente Botões (Largura Fixa) --><div class="controles-coluna col-fixed-buttons">
            <div class="controles-botoes">
                <button id="btnGerar" title="Preenche a tabela com os códigos colados">Gerar Romaneio</button>
                <button id="btnImprimir" title="Abre a janela de impressão">Imprimir</button>
            </div>
        </div>
    </div>


    <!-- 
      ***************************************************
      * *
      * MINUTA / ROMANEIO (A FOLHA)                     *
      * *
      ***************************************************
    --><div class="pagina">

        <!-- Início do Cabeçalho --><header class="cabecalho">
            <table class="tabela-cabecalho">
                <!-- Linha 1: Logo, Título, Data --><tr>
                    <td class="logo-cell">
                        <!-- Imagem da logo --><img src="https://upload.wikimedia.org/wikipedia/commons/0/01/J%26T_Express_logo.svg" alt="J&T Express Logo" class="logo-img"
                             onerror="this.style.display='none'; this.parentElement.innerHTML = '<div style=\'font-size: 28px; font-weight: bold; color: #E2001A;\'>J&T Express</div>';">
                    </td>
                    <td class="titulo-cell">
                        <h1>ROMANEIO DEVOLUÇÃO</h1>
                    </td>
                    <td class="data-cell">
                        <div>DATA</div>
                        <div class="data-valor" id="data-hoje"></div>
                    </td>
                </tr>
                <!-- Linha 2: Base Origem, Base Destino (ATUALIZADA com ID) --><tr>
                    <td colspan="2">
                        <strong>Base Origem:</strong> <span class="texto-vermelho">SC GYN (GO GYN)</span>
                    </td>
                    <td>
                        <strong>Base Destino:</strong> <span class="texto-vermelho" id="headerBaseDestino">MERCADO LIVRE - MELI</span>
                    </td>
                </tr>
                <!-- Linha 3: Campos (Natureza ATUALIZADA com ID) --><tr>
                    <td>
                        <div class="label-cinza">ID LACRE/ID VIAGEM</div>
                        <div class="valor-campo" id="headerLacre">&nbsp;</div>
                    </td>
                    <td style="text-align: center;"> 
                        <div class="label-cinza">Natureza:</div>
                        <!-- NOVO ID para Natureza --><div class="valor-campo" id="headerNatureza">DEVOLUÇÃO AO EMBARCADOR</div>
                    </td>
                    <td>
                        <table class="tabela-interna">
                            <tr>
                                <td class="label-cinza">Quantidade Total:</td>
                                <td class="label-cinza">PLACA VEICULO</td>
                            </tr>
                            <tr>
                                <!-- ID "headerQtd" será preenchido pelo script --><td class="valor-campo texto-vermelho" id="headerQtd" style="font-size: 1.2em; font-weight: bold;">&nbsp;</td>
                                <td class="valor-campo" id="headerPlaca">&nbsp;</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
            
            <!-- Fechando a tag <header> --></header>
        <!-- Fim do Cabeçalho --><!-- 
          ***************************************************
          * *
          * CONTEÚDO PRINCIPAL: TABELA DE CÓDIGOS           *
          * *
          ***************************************************
        --><main class="conteudo">
            <!-- Marcas d'água --><div class="watermark" id="wm-pagina1">Página 1</div>
            <div class="watermark" id="wm-pagina2">Página 2</div>

            <!-- Tabela de Códigos --><table class="tabela-romaneio">
                <tbody id="tabela-corpo">
                    <tr class="placeholder">
                        <td colspan="4">Cole os códigos na caixa acima e clique em "Gerar Romaneio"</td>
                    </tr>
                </tbody>
            </table>
        </main>
        <!-- Fim do Conteúdo Principal --><!-- 
          ***************************************************
          * *
          * RODAPÉ                                          *
          * *
          ***************************************************
        --><footer class="rodape">
            <!-- Tabela de Assinaturas (Rodapé) --><table class="tabela-rodape">
                <tr>
                    <td class="label-cinza-rodape">Assinatura Emitente</td>
                    <td class="label-cinza-rodape">Assinatura Motorista:</td>
                    <td class="label-cinza-rodape">Nome Recebedor:</td>
                    <td class="label-cinza-rodape">Data recebimento:</td>
                </tr>
                <tr>
                    <td class="linha-assinatura-rodape">&nbsp;</td>
                    <td class="linha-assinatura-rodape">&nbsp;</td>
                    <td class="linha-assinatura-rodape"><strong>DOCA N.:</strong> ______________</td>
                    <td class="linha-assinatura-rodape">&nbsp;</td>
                </tr>
            </table>

            <!-- Barra vermelha final --><div class="barra-vermelha-final"></div>
        </footer>
        <!-- Fim do Rodapé --></div> <!-- Fim da .pagina --><!--
      ***************************************************
      * *
      * SCRIPT JAVASCRIPT (LÓGICA INALTERADA)           *
      * *
      ***************************************************
    --><script>
        // Caractere de espaço que não quebra linha (&nbsp; em HTML)
        const nbsp = '\u00A0'; 

        // --- Função para sincronizar os campos do cabeçalho com os controles ---
        function atualizarCabecalho() {
            // Novas leituras
            const selectNatureza = document.getElementById('selectNatureza').value;
            const inputBaseDestino = document.getElementById('inputBaseDestino').value;

            // Leituras existentes
            const inputLacre = document.getElementById('inputLacre').value;
            const inputPlaca = document.getElementById('inputPlaca').value;
            
            // Conta a quantidade total de códigos
            const totalCodigos = document.getElementById('inputCodigos').value.split('\n').filter(Boolean).length;
            
            // Atualiza o Romaneio
            document.getElementById('headerNatureza').textContent = selectNatureza || nbsp;
            document.getElementById('headerBaseDestino').textContent = inputBaseDestino || nbsp;
            document.getElementById('headerLacre').textContent = inputLacre || nbsp;
            document.getElementById('headerPlaca').textContent = inputPlaca || nbsp;
            document.getElementById('headerQtd').textContent = totalCodigos > 0 ? totalCodigos : nbsp;  
        }


        // --- Função para gerar a tabela ---
        function gerarTabela() {
            const input = document.getElementById('inputCodigos');
            const tbody = document.getElementById('tabela-corpo');
            
            // Pega os códigos, separa por linha e remove linhas vazias
            const codigos = input.value.split('\n').filter(Boolean);
            const totalCodigos = codigos.length;
            
            // Limpa a tabela atual
            tbody.innerHTML = '';
            
            if (totalCodigos === 0) {
                tbody.innerHTML = `
                    <tr class="placeholder">
                        <td colspan="4">Nenhum código foi inserido. Cole os códigos na caixa de texto e clique em "Gerar Romaneio"</td>
                    </tr>`;
            } else {
                // Itera sobre os códigos de 4 em 4 para criar as linhas
                for (let i = 0; i < totalCodigos; i += 4) {
                    // Cria uma nova linha <tr>
                    const tr = document.createElement('tr');
                    
                    // Adiciona as 4 colunas <td>
                    tr.innerHTML = `
                        <td>${(codigos[i] || nbsp)}</td>
                        <td>${(codigos[i + 1] || nbsp)}</td>
                        <td>${(codigos[i + 2] || nbsp)}</td>
                        <td>${(codigos[i + 3] || nbsp)}</td>
                    `;
                    
                    // Adiciona a linha completa ao corpo da tabela
                    tbody.appendChild(tr);
                }
            }
            
            // ATUALIZAÇÃO: Sincroniza o cabeçalho
            atualizarCabecalho();
        }
        
        // --- Função para imprimir ---
        function imprimirPagina() {
            window.print();
        }
        
        // --- Função para formatar a data de hoje ---
        function carregarDataHoje() {
            const hoje = new Date();
            const dia = String(hoje.getDate()).padStart(2, '0');
            const mes = String(hoje.getMonth() + 1).padStart(2, '0'); // Meses começam do 0
            const ano = hoje.getFullYear();
            document.getElementById('data-hoje').textContent = `${dia}/${mes}/${ano}`;
        }
        
        // --- Inicialização da Aplicação ---
        function init() {
            carregarDataHoje();
            // Preenche o cabeçalho com os valores padrão ao carregar a página
            atualizarCabecalho(); 
            
            // Adiciona listeners para Natureza e Base Destino para atualizar dinamicamente
            document.getElementById('selectNatureza').addEventListener('change', atualizarCabecalho);
            document.getElementById('inputBaseDestino').addEventListener('input', atualizarCabecalho);
            document.getElementById('inputLacre').addEventListener('input', atualizarCabecalho);
            document.getElementById('inputPlaca').addEventListener('input', atualizarCabecalho);
            
            // Adiciona listeners para os botões existentes
            document.getElementById('btnGerar').addEventListener('click', gerarTabela);
            document.getElementById('btnImprimir').addEventListener('click', imprimirPagina);
        }

        // Inicia a aplicação após o carregamento do DOM
        document.addEventListener('DOMContentLoaded', init);
        
    </script>

</body>
</html>
